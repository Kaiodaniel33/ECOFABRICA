<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoF√°brica Consciente - A Jornada do Aprendiz</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Poppins:wght@600&display=swap" rel="stylesheet">

    <style>
        /* ==========================================================================
           VIRTUAL FILE: /css/core/_variables.css
           DESCRI√á√ÉO: Define todos os tokens de design (cores, fontes, etc.)
           ========================================================================== */
        :root {
            /* PROFESSOR SABI√Å: 
                Vari√°veis CSS (ou "Custom Properties") s√£o nosso "painel de controle" de design.
                Se quisermos mudar o verde principal do site, mudamos APENAS aqui
                em '--color-primary' e... pronto! M√°gica, n√£o?
            */
            
            /* Paleta de Cores Principal */
            --color-primary-dark: #225c51;
            --color-primary: #2c786c;
            --color-primary-light: #4a7c59;
            --color-primary-extralight: #e8f5e9; /* Verde bem claro para fundos */

            /* Paleta de Feedback */
            --color-success: #4caf50;
            --color-warning: #ff9800;
            --color-danger: #f44336;
            --color-info: #2196f3;

            /* Paleta Neutra (Texto e Fundos) */
            --color-text-primary: #212121;
            --color-text-secondary: #5f6368;
            --color-text-light: #ffffff;
            --color-border: #e0e0e0;
            --color-disabled: #bdbdbd;
            --color-background-main: #f4f7f6; /* Fundo principal da p√°gina */
            --color-background-container: #ffffff; /* Fundo dos "cards" */
            --color-background-modal: rgba(0, 0, 0, 0.6);
            --color-background-mentor: #fffbeb; /* Fundo da caixa do Professor Sabi√° */

            /* Tipografia */
            --font-family-body: 'Roboto', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            --font-family-heading: 'Poppins', sans-serif;
            --font-size-base: 16px;
            --line-height-base: 1.6;

            /* Outras Vari√°veis */
            --border-radius-small: 4px;
            --border-radius-medium: 8px;
            --border-radius-large: 12px;
            --shadow-light: 0 2px 4px rgba(0,0,0,0.05);
            --shadow-medium: 0 4px 12px rgba(0,0,0,0.1);
            --shadow-heavy: 0 8px 24px rgba(0,0,0,0.15);
            --transition-speed: 0.2s ease-in-out;
        }

        /* ==========================================================================
           VIRTUAL FILE: /css/core/_reset.css
           DESCRI√á√ÉO: Normaliza os estilos padr√µes do navegador.
           ========================================================================== */
        *,
        *::before,
        *::after {
            box-sizing: border-box; 
            /* PROFESSOR SABI√Å: 
                'box-sizing: border-box' √© OBRIGAT√ìRIO hoje em dia.
                Ele faz com que o 'padding' e a 'border' sejam inclu√≠dos
                na largura (width) e altura (height) total do elemento.
                Isso torna os c√°lculos de layout MIL VEZES mais f√°ceis.
            */
        }
        
        html {
            font-size: var(--font-size-base);
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-family-body);
            line-height: var(--line-height-base);
            color: var(--color-text-primary);
            background-color: var(--color-background-main);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* ==========================================================================
           VIRTUAL FILE: /css/core/_typography.css
           DESCRI√á√ÉO: Estilos base de texto
           ========================================================================== */
        h1, h2, h3, h4, h5, h6 {
            font-family: var(--font-family-heading);
            color: var(--color-primary-dark);
            margin: 0 0 0.75em 0;
            line-height: 1.2;
        }
        h1 { font-size: 2.25rem; }
        h2 { font-size: 1.75rem; color: var(--color-primary); }
        h3 { font-size: 1.25rem; color: var(--color-primary-light); }
        h4 { 
            font-size: 1.1rem; 
            color: var(--color-text-primary);
            border-bottom: 2px solid var(--color-border);
            padding-bottom: 8px;
            margin-top: 24px;
            text-align: left;
        }
        
        p { margin: 0 0 1em 0; }
        a { color: var(--color-primary); text-decoration: none; }
        a:hover { text-decoration: underline; }
        small { font-size: 0.85em; color: var(--color-text-secondary); }

        /* ==========================================================================
           VIRTUAL FILE: /css/layout/_main.css
           DESCRI√á√ÉO: Estilos principais de layout (container, grid, etc.)
           ========================================================================== */
        
        /* Layout Principal do Jogo */
        .l-game-wrapper {
            background-color: var(--color-background-container);
            padding: 25px 30px;
            border-radius: var(--border-radius-large);
            box-shadow: var(--shadow-medium);
            width: 100%;
            max-width: 1100px;
            position: relative;
            border-top: 5px solid var(--color-primary);
        }

        /* Layout das colunas de A√ß√µes e P&D */
        .l-columns {
            display: grid;
            /* PROFESSOR SABI√Å: 
                'grid-template-columns: repeat(auto-fit, minmax(300px, 1fr))'
                Isso √© CSS Grid moderno! Significa: crie colunas que
                tenham NO M√çNIMO 300px. Se couber mais de uma (auto-fit),
                distribua o espa√ßo restante igualmente (1fr).
                Isso √© responsividade autom√°tica!
            */
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            text-align: left;
            margin-top: 20px;
        }

        .l-credits-footer {
            margin-top: 25px;
            text-align: center;
            font-size: 0.8em;
            color: var(--color-text-secondary);
        }

        /* ==========================================================================
           VIRTUAL FILE: /css/components/_button.css
           DESCRI√á√ÉO: Estilos para TODOS os bot√µes (Sistema de Design)
           ========================================================================== */
        /* COMENT√ÅRIO DO ENGENHEIRO:
            Usando uma abordagem BEM-like (Block__Element--Modifier)
            .c-btn  (Block)
            .c-btn--primary (Modifier)
            .c-btn--full-width (Modifier)
        */
        .c-btn {
            font-family: var(--font-family-body);
            font-weight: 700;
            font-size: 1rem;
            color: var(--color-text-light);
            background-color: var(--color-primary-light);
            border: none;
            padding: 12px 20px;
            margin: 5px;
            border-radius: var(--border-radius-medium);
            cursor: pointer;
            text-align: center;
            transition: all var(--transition-speed);
            display: inline-block;
        }

        .c-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-light);
        }

        .c-btn:active:not(:disabled) {
            transform: translateY(0);
        }

        .c-btn:disabled {
            background-color: var(--color-disabled) !important;
            color: var(--color-text-secondary);
            cursor: not-allowed;
            opacity: 0.7;
            transform: none;
            box-shadow: none;
        }
        
        /* Modificadores de Cor */
        .c-btn--start { background-color: var(--color-success); }
        .c-btn--next-month { background-color: var(--color-warning); color: var(--color-text-primary); }
        .c-btn--decision { background-color: var(--color-info); }
        .c-btn--research { background-color: #673ab7; } /* Roxo para P&D */
        .c-btn--event { background-color: var(--color-primary-dark); }
        .c-btn--profile { background-color: var(--color-primary-light); }
        .c-btn--profile.is-selected {
            background-color: var(--color-primary-dark);
            transform: scale(1.03);
            box-shadow: var(--shadow-medium);
        }

        /* Modificadores de Layout */
        .c-btn--full-width {
            display: block;
            width: 100%;
            margin: 10px 0;
        }
        
        .c-btn--action {
            display: block;
            width: 100%;
            margin: 8px 0;
            text-align: left;
            padding-left: 15px;
        }
        .c-btn--action small {
            display: block;
            font-weight: 400;
            opacity: 0.9;
            color: var(--color-text-light);
        }
        .c-btn--action .cost { color: var(--color-warning); font-weight: 700; }
        .c-btn--action .rp { color: #d1c4e9; font-weight: 700; } /* Roxo claro */
        
        .c-btn--audio-toggle {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 45px;
            height: 45px;
            font-size: 1.5em;
            padding: 0;
            line-height: 1;
            border-radius: 50%;
            background-color: var(--color-primary-light);
            z-index: 10;
        }

        /* ==========================================================================
           VIRTUAL FILE: /css/components/_stats-grid.css
           DESCRI√á√ÉO: O painel principal de estat√≠sticas do jogo
           ========================================================================== */
        .c-stats-grid {
            display: grid;
            /* PROFESSOR SABI√Å: 
                'minmax(180px, 1fr)' √© √≥timo!
                Estamos dizendo: "Cada item deve ter no m√≠nimo 180px,
                mas se houver espa√ßo sobrando (1fr), pode crescer para preench√™-lo."
                Novamente, CSS Grid fazendo m√°gica na responsividade.
            */
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
            padding: 15px;
            background-color: var(--color-primary-extralight);
            border-radius: var(--border-radius-medium);
        }

        .c-stats-grid__item {
            padding: 12px;
            background-color: var(--color-background-container);
            border-radius: var(--border-radius-small);
            font-size: 0.95em;
            border: 1px solid var(--color-border);
            text-align: left;
            box-shadow: var(--shadow-light);
        }

        .c-stats-grid__label {
            display: block;
            font-size: 0.85em;
            color: var(--color-text-secondary);
            margin-bottom: 4px;
        }
        
        .c-stats-grid__value {
            font-weight: 700;
            color: var(--color-primary-dark);
            font-size: 1.25em;
        }

        /* Modificadores de cor para valores espec√≠ficos */
        .c-stats-grid__value--budget { color: var(--color-success); }
        .c-stats-grid__value--waste { color: var(--color-danger); }
        .c-stats-grid__value--morale { color: var(--color-info); }
        .c-stats-grid__value--reputation { color: var(--color-primary-light); }


        /* ==========================================================================
           VIRTUAL FILE: /css/components/_log.css
           DESCRI√á√ÉO: O log de eventos do jogo
           ========================================================================== */
        .c-game-log {
            margin-top: 20px;
            padding: 15px;
            background-color: #fdfdfd;
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius-medium);
            text-align: left;
            height: 200px; /* Altura aumentada */
            overflow-y: auto;
            font-size: 0.9em;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
        }

        .c-game-log__entry {
            margin: 0 0 8px 0;
            padding: 8px;
            border-bottom: 1px dashed var(--color-border);
        }
        .c-game-log__entry:first-child { 
            animation: fadeIn 0.5s ease;
        }
        .c-game-log__entry:last-child { 
            border-bottom: none; 
        }

        /* Modificadores de tipo de log */
        .c-game-log__entry--good { color: var(--color-success); }
        .c-game-log__entry--bad { color: var(--color-danger); }
        .c-game-log__entry--neutral { color: var(--color-info); }
        .c-game-log__entry--sabia { 
            font-style: italic; 
            color: var(--color-primary-dark);
            background-color: var(--color-primary-extralight);
            border-radius: var(--border-radius-small);
        }
        .c-game-log__entry--sabia strong { color: var(--color-primary); }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ==========================================================================
           VIRTUAL FILE: /css/components/_forms.css
           DESCRI√á√ÉO: Estilos para inputs e labels
           ========================================================================== */
        .c-form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .c-form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 700;
            color: var(--color-primary-light);
            font-size: 1.1em;
        }

        .c-form-group input[type="text"] {
            padding: 12px;
            width: 100%;
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius-medium);
            font-size: 1rem;
            transition: border-color var(--transition-speed), box-shadow var(--transition-speed);
        }
        
        .c-form-group input[type="text"]:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px var(--color-primary-extralight);
        }

        /* ==========================================================================
           VIRTUAL FILE: /css/components/_modal.css
           DESCRI√á√ÉO: Estilos para pop-ups (Relat√≥rio, Eventos, Professor)
           ========================================================================== */
        .c-modal {
            display: none; /* Controlado por JS */
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: var(--color-background-modal);
            animation: fadeIn 0.3s;
        }

        .c-modal__content {
            background-color: var(--color-background-container);
            margin: 10% auto;
            padding: 30px;
            border: 1px solid var(--color-border);
            width: 90%;
            max-width: 700px;
            border-radius: var(--border-radius-large);
            box-shadow: var(--shadow-heavy);
            position: relative;
            animation: slideIn 0.4s;
        }

        .c-modal__close-btn {
            color: var(--color-text-secondary);
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color var(--transition-speed);
        }
        .c-modal__close-btn:hover,
        .c-modal__close-btn:focus {
            color: var(--color-text-primary);
            text-decoration: none;
            outline: none;
        }
        
        /* Modificador para o modal do Professor */
        .c-modal__content--sabia {
            border-top: 5px solid var(--color-warning);
        }
        
        .c-modal__content--sabia h2 {
            color: var(--color-warning);
        }
        
        .c-modal__content--event {
            border-top: 5px solid var(--color-danger);
        }
        
        .c-modal__content--event h2 {
            color: var(--color-danger);
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ==========================================================================
           VIRTUAL FILE: /css/components/_chart.css
           DESCRI√á√ÉO: Estilos para o gr√°fico de barras do relat√≥rio
           ========================================================================== */
        .c-chart-container {
            display: flex;
            justify-content: space-around;
            align-items: flex-end;
            height: 250px;
            border-bottom: 2px solid var(--color-text-primary);
            padding: 10px;
            box-sizing: border-box;
            margin-top: 20px;
        }
        
        .c-chart-bar-wrapper {
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: center;
            margin: 0 5px;
            flex-grow: 1;
            text-align: center;
        }

        .c-chart-bar {
            width: 100%;
            max-width: 40px; /* Largura m√°xima da barra */
            text-align: center;
            color: var(--color-text-light);
            font-size: 0.9em;
            position: relative;
            transition: height 0.5s ease-out;
            display: flex;
            justify-content: center;
            align-items: flex-end;
            padding-bottom: 5px;
            box-sizing: border-box;
            border-radius: var(--border-radius-small) var(--border-radius-small) 0 0;
        }

        .c-chart-bar__value {
            font-weight: bold;
            background: rgba(0,0,0,0.2);
            padding: 1px 3px;
            border-radius: var(--border-radius-small);
        }

        .c-chart-bar__label {
            margin-top: 8px;
            color: var(--color-text-primary);
            font-size: 0.85em;
            font-weight: 700;
        }

        .c-chart-bar--budget { background-color: var(--color-success); }
        .c-chart-bar--sustainability { background-color: var(--color-primary); }
        .c-chart-bar--waste { background-color: var(--color-danger); }

        /* ==========================================================================
           VIRTUAL FILE: /css/components/_professor-sabia.css
           DESCRI√á√ÉO: Estilos para a UI do Professor Sabi√°
           ========================================================================== */
        .c-sabia-mentor {
            padding: 15px;
            margin-top: 20px;
            background-color: var(--color-background-mentor);
            border: 1px solid var(--color-warning);
            border-radius: var(--border-radius-medium);
            text-align: left;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: var(--shadow-light);
        }

        .c-sabia-mentor__icon {
            font-size: 2.5em;
            flex-shrink: 0;
        }

        .c-sabia-mentor__content h4 {
            margin: 0 0 5px 0;
            color: var(--color-warning);
            border-bottom: none;
            font-size: 1.1em;
        }

        .c-sabia-mentor__content p {
            margin: 0;
            font-size: 0.95em;
            color: var(--color-text-secondary);
        }

        /* ==========================================================================
           VIRTUAL FILE: /css/layout/_responsive.css
           DESCRI√á√ÉO: Media Queries para responsividade
           ========================================================================== */
        @media (max-width: 768px) {
            body { padding: 10px; }
            .l-game-wrapper { padding: 15px; }
            
            h1 { font-size: 1.8rem; }
            h2 { font-size: 1.5rem; }

            .l-columns {
                grid-template-columns: 1fr; /* For√ßa uma coluna √∫nica */
            }

            .c-stats-grid {
                grid-template-columns: 1fr 1fr; /* For√ßa duas colunas */
            }

            .c-modal__content {
                width: 95%;
                margin: 15% auto;
                padding: 20px;
            }

            .c-sabia-mentor {
                flex-direction: column;
                text-align: center;
            }
        }

        @media (max-width: 480px) {
            .c-stats-grid {
                grid-template-columns: 1fr; /* For√ßa uma coluna √∫nica em telas muito pequenas */
            }
            .c-chart-bar__value { font-size: 0.7em; }
            .c-chart-bar__label { font-size: 0.7em; }
        }

        /* ==========================================================================
           VIRTUAL FILE: /css/utils/_helpers.css
           DESCRI√á√ÉO: Classes utilit√°rias (ex: esconder/mostrar)
           ========================================================================== */
        .u-hidden {
            display: none !important;
        }
        
        .u-text-danger { color: var(--color-danger); }
        .u-text-success { color: var(--color-success); }
        .u-text-center { text-align: center; }

    </style>
</head>
<body>
    <audio id="background-music" src="https://www.chosic.com/wp-content/uploads/2021/04/And-So-It-Begins-Inspired-By-Crush-Sometimes.mp3" loop></audio>

    <main class="l-game-wrapper">
        <header class="l-game-header">
            <button id="music-toggle" class="c-btn c-btn--audio-toggle" aria-label="Ativar ou desativar m√∫sica">üéµ</button>
            <h1 class="u-text-center">EcoF√°brica Consciente</h1>
            <h2 id="game-header" class="u-text-center">A Jornada do Aprendiz</h2>
        </header>
        
        <section id="start-screen">
            <div class="c-form-group">
                <label for="player-name-input">Nome do(a) Jovem Gestor(a):</label>
                <input type="text" id="player-name-input" placeholder="Digite seu nome aqui">
            </div>
            
            <div id="profile-selection">
                <h4>Escolha seu Perfil de Gest√£o:</h4>
                <button class="c-btn c-btn--profile c-btn--full-width" data-profile="visionario">
                    <strong>üåé Vision√°rio Verde</strong>
                    <small>Meta: Maximizar Sustentabilidade (100) e Reputa√ß√£o (90).</small>
                </button>
                <button class="c-btn c-btn--profile c-btn--full-width" data-profile="capitalista">
                    <strong>üí∞ Capitalista Consciente</strong>
                    <small>Meta: Maximizar o Lucro (R$ 5000) e Sustentabilidade (60).</small>
                </button>
                <button class="c-btn c-btn--profile c-btn--full-width" data-profile="lider">
                    <strong>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ L√≠der Comunit√°rio</strong>
                    <small>Meta: Maximizar a Moral da Equipe (100) e Reputa√ß√£o (95).</small>
                </button>
            </div>
            <button id="start-button" class="c-btn c-btn--start c-btn--full-width" disabled>Aceitar o Desafio e Iniciar Gest√£o!</button>
        </section>

        <section id="game-screen" class="u-hidden">
            <div id="stats-grid" class="c-stats-grid"></div>

            <aside id="sabia-mentor-ui" class="c-sabia-mentor">
                <div class="c-sabia-mentor__icon">ü¶â</div>
                <div class="c-sabia-mentor__content">
                    <h4 id="sabia-tip-title">Dica do Professor Sabi√°</h4>
                    <p id="sabia-tip-text">Bem-vindo(a)! Preste aten√ß√£o nas suas m√©tricas. O equil√≠brio √© a chave!</p>
                </div>
            </aside>
            
            <div class="l-columns">
                <div id="decisions-column">
                    <h4>Tomada de Decis√£o (A√ß√µes)</h4>
                    </div>
                <div id="research-column">
                    <h4>Pesquisa & Desenvolvimento (P&D)</h4>
                    </div>
            </div>

            <div style="margin-top: 30px; text-align: center;">
                <button id="show-report-button" class="c-btn">Ver Relat√≥rio de Desempenho</button>
                <button id="next-month-button" class="c-btn c-btn--next-month c-btn--full-width">Avan√ßar para Pr√≥ximo M√™s</button>
            </div>

            <h4>Log de Eventos</h4>
            <div id="game-log" class="c-game-log"></div>
        </section>

        <section id="end-screen" class="u-hidden u-text-center">
            <h2>Fim do Ciclo de Gest√£o!</h2>
            <p>Confira o desempenho final da sua ECOF√ÅBRICA CONSCIENTE:</p>
            <div id="final-stats-grid" class="c-stats-grid"></div>
            <p id="final-message" style="font-size: 1.2em; font-weight: bold;"></p>
            <button id="restart-button" class="c-btn c-btn--start c-btn--full-width">Iniciar Nova Gest√£o (Recarregar)</button>
        </section>

        <footer class="l-credits-footer">
            <p><strong>Desenvolvimento do Conceito e Jogo Base:</strong> Kaio Daniel de Souza da Costa (1¬∫ A), Lucas Raczenski Marques (2¬∫ A), Murilo Silvestre Bernardes (2¬∫ A), Marielly (2¬∫ A), Stefany (2¬∫ A), Lucas Gabriel Kruger Avelino (2¬∫ A)</p>
            <p><strong>Re-arquitetura e Expans√£o (V2):</strong> Gemini, Engenheiro S√™nior</p>
            <p>C.E. PROFESSOR IVONE SOARES CASTANHARO | <strong>Professor Monitor Orientador:</strong> Felipe Oliveira TI</p>
        </footer>
    </main>

    <div id="report-modal" class="c-modal" role="dialog" aria-modal="true" aria-labelledby="report-modal-title">
        <div class="c-modal__content">
            <span class="c-modal__close-btn" data-modal-id="report-modal">&times;</span>
            <h2 id="report-modal-title">Relat√≥rio de Desempenho</h2>
            <p>Evolu√ß√£o mensal das suas principais m√©tricas:</p>
            <div id="chart-container" class="c-chart-container">
                </div>
            <div style="display: flex; justify-content: space-around; margin-top: 10px; font-size: 0.9em;">
                <span><span style="color:var(--color-success)">‚ñ†</span> Or√ßamento</span>
                <span><span style="color:var(--color-primary)">‚ñ†</span> Sustentabilidade</span>
                <span><span style="color:var(--color-danger)">‚ñ†</span> Desperd√≠cio</span>
            </div>
        </div>
    </div>
    
    <div id="event-modal" class="c-modal" role="dialog" aria-modal="true" aria-labelledby="event-modal-title">
        <div class="c-modal__content c-modal__content--event">
            <span class="c-modal__close-btn u-hidden">&times;</span> <h2 id="event-modal-title">Acontecimento!</h2>
            <p id="event-modal-message">Uma situa√ß√£o inesperada ocorreu!</p>
            <div id="event-modal-choices">
                </div>
        </div>
    </div>
    
    <div id="sabia-quiz-modal" class="c-modal" role="dialog" aria-modal="true" aria-labelledby="sabia-quiz-title">
        <div class="c-modal__content c-modal__content--sabia">
            <span class="c-modal__close-btn" data-modal-id="sabia-quiz-modal">&times;</span>
            <h2 id="sabia-quiz-title">ü¶â Pergunta do Professor Sabi√°!</h2>
            <p>Vamos testar seu conhecimento de c√≥digo, jovem aprendiz!</p>
            <p id="sabia-quiz-question" style="font-weight: 700; font-size: 1.1em;"></p>
            <div id="sabia-quiz-choices">
                </div>
            <p id="sabia-quiz-feedback" style="margin-top: 15px;"></p>
        </div>
    </div>


    <script>
    /*
    PROFESSOR SABI√Å: 
    
    Ol√°, aprendiz! Bem-vindo ao "c√≥digo-fonte"!
    
    Tudo no JavaScript moderno come√ßa com 'document.addEventListener("DOMContentLoaded", ...)'.
    
    Isso diz ao navegador: "Ei, n√£o execute NENHUM JavaScript
    at√© que todo o HTML da p√°gina esteja carregado e pronto."
    
    √â a nossa "luz verde" para come√ßar o jogo!
    */
    document.addEventListener("DOMContentLoaded", () => {

        /* ==========================================================================
           VIRTUAL FILE: /js/utils/helpers.js
           DESCRI√á√ÉO: Fun√ß√µes utilit√°rias puras e reutiliz√°veis.
           ========================================================================== */
        const Helpers = {
            /**
             * Formata um n√∫mero como moeda BRL (Real)
             * @param {number} value - O n√∫mero a ser formatado
             * @returns {string} - Ex: "R$ 1.500,00"
             */
            formatCurrency: (value) => {
                // PROFESSOR SABI√Å: 'Intl.NumberFormat' √© a forma moderna e correta
                // de formatar n√∫meros (moedas, datas, etc.) em QUALQUER l√≠ngua!
                // Chega de 'toFixed(2)' e gambiarras com strings.
                return new Intl.NumberFormat('pt-BR', {
                    style: 'currency',
                    currency: 'BRL',
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0,
                }).format(value || 0);
            },

            /**
             * Limita um n√∫mero a um intervalo (m√≠nimo e m√°ximo)
             * @param {number} value - O valor
             * @param {number} min - O limite m√≠nimo
             * @param {number} max - O limite m√°ximo
             * @returns {number}
             */
            clamp: (value, min, max) => {
                // PROFESSOR SABI√Å: Uma fun√ß√£o "clamp" (trava) √© super √∫til em jogos
                // para garantir que a 'Moral' n√£o passe de 100 ou o 'Or√ßamento'
                // n√£o fique abaixo de 0 (a menos que voc√™ queira).
                return Math.max(min, Math.min(value, max));
            },
            
            /**
             * Pega um item aleat√≥rio de um array
             * @param {Array<any>} arr - O array
             * @returns {any} - Um item aleat√≥rio
             */
            getRandomItem: (arr) => {
                if (!arr || arr.length === 0) return null;
                return arr[Math.floor(Math.random() * arr.length)];
            }
        };


        /* ==========================================================================
           VIRTUAL FILE: /js/config/SabiaData.js
           DESCRI√á√ÉO: A "Intelig√™ncia" do Professor Sabi√°.
                      Base de conhecimento GIGANTE sobre c√≥digo e o jogo.
           ========================================================================== */
        const SABIA_KNOWLEDGE_BASE = {
            // Dicas contextuais sobre o JOGO
            gameTips: [
                { 
                    condition: (s) => s.budget < 500,
                    tip: "Seu or√ßamento est√° perigosamente baixo! Evite gastos grandes e foque em a√ß√µes que gerem receita ou reduzam custos, como 'Otimizar Log√≠stica'." 
                },
                { 
                    condition: (s) => s.waste > 60,
                    tip: "O n√≠vel de desperd√≠cio est√° alt√≠ssimo! Isso gera custos e afeta sua reputa√ß√£o. Invista em 'Reciclagem B√°sica' ou 'Treinamento de Efici√™ncia' urgente!" 
                },
                { 
                    condition: (s) => s.morale < 40,
                    tip: "A moral da equipe est√° em queda. Funcion√°rios infelizes produzem menos e podem sair. Considere 'Melhorar refeit√≥rio' ou 'Capacitar Equipe'." 
                },
                { 
                    condition: (s) => s.sustainability < 20,
                    tip: "Sua opera√ß√£o n√£o √© nada sustent√°vel. A fiscaliza√ß√£o pode bater na sua porta. 'Investir em Energia Solar' √© caro, mas resolve isso a longo prazo."
                },
                { 
                    condition: (s) => s.researchPoints > 15,
                    tip: "Voc√™ acumulou muitos Pontos de P&D! N√£o os deixe parados. Pesquise novas tecnologias para desbloquear a√ß√µes mais poderosas."
                },
                { 
                    condition: (s) => s.currentMonth === 1,
                    tip: "Primeiro m√™s! Analise seu perfil de gestor. Se voc√™ √© 'Vision√°rio Verde', sua prioridade √© Sustentabilidade, n√£o apenas lucro." 
                },
                { 
                    condition: (s) => s.currentMonth === 6,
                    tip: "Estamos no meio do ano. √â um bom momento para checar o Relat√≥rio de Desempenho e ver sua evolu√ß√£o. Ajuste sua estrat√©gia!" 
                },
                {
                    condition: (s) => s.currentMonth === 11,
                    tip: "Reta final! Se voc√™ est√° longe da sua meta, talvez precise de uma a√ß√£o de 'alto risco, alta recompensa'. Boa sorte!"
                }
            ],
            
            // Perguntas do Quiz sobre C√ìDIGO (HTML, CSS, JS)
            quizQuestions: [
                {
                    area: "HTML",
                    question: "Qual tag HTML √© usada para o *conte√∫do principal* de uma p√°gina, ajudando na sem√¢ntica e acessibilidade?",
                    options: ["<div class='main'>", "<main>", "<content>", "<body-content>"],
                    answer: "<main>",
                    explanation: "<main> √© a tag sem√¢ntica correta. Leitores de tela usam ela para pular direto ao conte√∫do principal."
                },
                {
                    area: "HTML",
                    question: "Para que serve o atributo 'for' em uma tag <label>?",
                    options: ["Para criar um loop 'for'", "Para conectar o label a um 'id' de um <input>", "Para definir a fonte do texto", "Para uso em formul√°rios de 'for'necedores"],
                    answer: "Para conectar o label a um 'id' de um <input>",
                    explanation: "O 'for' no <label> √© vinculado ao 'id' do <input>, melhorando a acessibilidade e a usabilidade (clicar no label foca o input)."
                },
                {
                    area: "HTML",
                    question: "O que significa o atributo 'data-profile' que usamos nos bot√µes de perfil?",
                    options: ["Define o CSS do perfil", "√â um atributo de dados ('data attribute') para guardar informa√ß√µes customizadas", "√â um link para o perfil do usu√°rio", "N√£o tem fun√ß√£o, √© apenas um coment√°rio"],
                    answer: "√â um atributo de dados ('data attribute') para guardar informa√ß√µes customizadas",
                    explanation: "Data attributes (come√ßam com 'data-') s√£o uma forma padr√£o de armazenar dados no HTML para serem lidos pelo JavaScript."
                },
                {
                    area: "CSS",
                    question: "O que 'box-sizing: border-box;' faz?",
                    options: ["Coloca uma borda em todas as caixas", "Calcula o tamanho da caixa incluindo padding e border na largura/altura total", "Calcula o tamanho da caixa somando padding e border √† largura/altura", "Centraliza a caixa na p√°gina"],
                    answer: "Calcula o tamanho da caixa incluindo padding e border na largura/altura total",
                    explanation: "Por padr√£o, 'width' + 'padding' + 'border' = largura real. Com 'border-box', 'width' = largura real (incluindo padding/border). Isso facilita layouts!"
                },
                {
                    area: "CSS",
                    question: "Qual a *vantagem* de usar Vari√°veis CSS (ex: '--color-primary')?",
                    options: ["Deixa o CSS mais r√°pido", "√â a √∫nica forma de usar cores", "Permite mudar um valor (ex: uma cor) em um s√≥ lugar e atualizar o site inteiro", "Funciona em navegadores antigos como o IE6"],
                    answer: "Permite mudar um valor (ex: uma cor) em um s√≥ lugar e atualizar o site inteiro",
                    explanation: "Vari√°veis centralizam seus valores de design ('tokens'). Mude a vari√°vel '--color-primary' e todos os elementos que a usam mudam instantaneamente."
                },
                {
                    area: "CSS",
                    question: "No CSS Grid, o que 'repeat(auto-fit, minmax(200px, 1fr))' significa?",
                    options: ["Cria 200 colunas", "Repete o layout 1 vez", "Cria colunas de 200px que n√£o crescem", "Cria o m√°ximo de colunas que couberem, com no m√≠nimo 200px, e distribui o espa√ßo extra (1fr)"],
                    answer: "Cria o m√°ximo de colunas que couberem, com no m√≠nimo 200px, e distribui o espa√ßo extra (1fr)",
                    explanation: "√â uma das regras mais poderosas do CSS Grid para criar layouts responsivos automaticamente, sem precisar de media queries!"
                },
                {
                    area: "JS",
                    question: "O que o 'document.addEventListener(\"DOMContentLoaded\", ...)' faz?",
                    options: ["Inicia o download do HTML", "Espera o DOM (HTML) estar totalmente carregado antes de rodar o JS", "Carrega as fontes do documento", "Cria um evento de clique"],
                    answer: "Espera o DOM (HTML) estar totalmente carregado antes de rodar o JS",
                    explanation: "Isso previne erros! Se o JS rodar antes do HTML, ele pode tentar achar um bot√£o (ex: 'start-button') que *ainda n√£o existe* e quebrar."
                },
                {
                    area: "JS",
                    question: "Qual a diferen√ßa entre 'let' e 'const'?",
                    options: ["'let' √© para n√∫meros, 'const' √© para texto", "'let' pode ter seu valor reatribu√≠do, 'const' n√£o pode", "'const' √© mais r√°pido que 'let'", "N√£o h√° diferen√ßa, s√£o a mesma coisa"],
                    answer: "'let' pode ter seu valor reatribu√≠do, 'const' n√£o pode",
                    explanation: "'const' (constante) cria uma vari√°vel que n√£o pode ser reatribu√≠da. 'let' cria uma vari√°vel que pode. Regra de ouro: use 'const' sempre, a menos que voc√™ *precise* mudar o valor, a√≠ use 'let'."
                },
                {
                    area: "JS",
                    question: "Para que serve a 'Intl.NumberFormat('pt-BR', ...)' que usamos?",
                    options: ["Para formatar n√∫meros internacionais", "Para formatar n√∫meros e moedas no padr√£o correto de uma l√≠ngua (ex: R$ 1.234,56)", "Para traduzir a p√°gina", "Para calcular impostos"],
                    answer: "Para formatar n√∫meros e moedas no padr√£o correto de uma l√≠ngua (ex: R$ 1.234,56)",
                    explanation: "'Intl' (Internationalization) √© a API nativa do JS para lidar com formatos de data, hora e n√∫meros em diferentes locais do mundo."
                },
                {
                    area: "JS",
                    question: "O que √© uma 'Classe' (como 'class Game' que usamos)?",
                    options: ["Um arquivo de CSS", "Uma 'planta' ou 'molde' para criar objetos com as mesmas propriedades e m√©todos", "Uma fun√ß√£o que roda sozinha", "Um tipo de coment√°rio"],
                    answer: "Uma 'planta' ou 'molde' para criar objetos com as mesmas propriedades e m√©todos",
                    explanation: "A 'class Game' √© o molde. Quando fazemos 'new Game()', criamos um *objeto* (uma 'inst√¢ncia') daquele molde, que j√° vem com 'state', 'ui', 'sabia', e os m√©todos 'advanceMonth()', etc."
                },
                {
                    area: "JS",
                    question: "Por que separamos o c√≥digo em classes como 'Game', 'State' e 'UI'?",
                    options: ["Porque √© obrigat√≥rio pelo navegador", "Para o c√≥digo ficar mais longo", "Chama-se 'Separa√ß√£o de Preocupa√ß√µes' (SoC). Cada classe tem UMA responsabilidade, facilitando a manuten√ß√£o.", "Para confundir quem est√° lendo"],
                    answer: "Chama-se 'Separa√ß√£o de Preocupa√ß√µes' (SoC). Cada classe tem UMA responsabilidade, facilitando a manuten√ß√£o.",
                    explanation: "A 'UI' s√≥ mexe no HTML. A 'State' s√≥ guarda dados. O 'Game' orquestra tudo. Se o layout quebrar, mexemos s√≥ na 'UI'. Se o c√°lculo de lucro estiver errado, mexemos s√≥ na 'State'. Isso √© arquitetura s√≥lida!"
                }
            ]
        };


        /* ==========================================================================
           VIRTUAL FILE: /js/config/GameData.js
           DESCRI√á√ÉO: A defini√ß√£o de TODO o conte√∫do do jogo.
                      Expandido massivamente para criar profundidade.
           ========================================================================== */
        const GAME_DATA = {
            totalMonths: 12,
            
            // Estado inicial base
            initialState: {
                budget: 1500,           // üí∞ Or√ßamento
                production: 50,         // üè≠ Produ√ß√£o/m√™s
                waste: 40,              // üóëÔ∏è Desperd√≠cio/m√™s
                sustainability: 20,     // üåé Sustentabilidade (0-100)
                morale: 60,             // üòä Moral Equipe (0-100)
                reputation: 30,         // üìà Reputa√ß√£o (0-100)
                researchPoints: 5,      // üî¨ Pontos P&D
                land: 10,               // üå≥ √Årea Agr√≠cola (hectares)
                marketPriceModifier: 1.0, // üí≤ Modificador de pre√ßo
            },
            
            // Nomes de exibi√ß√£o para as estat√≠sticas
            statDisplayNames: {
                budget: "Or√ßamento",
                production: "Produ√ß√£o/m√™s",
                waste: "Desperd√≠cio/m√™s",
                sustainability: "Sustentabilidade",
                morale: "Moral da Equipe",
                reputation: "Reputa√ß√£o",
                researchPoints: "Pontos P&D",
                land: "√Årea Agr√≠cola (ha)",
                marketPriceModifier: "Pre√ßo de Mercado"
            },
            
            // Perfis de Gest√£o e Condi√ß√µes de Vit√≥ria
            profiles: {
                visionario: {
                    name: "Vision√°rio Verde üåé",
                    description: "Sua gest√£o foi um exemplo para o Paran√°! Voc√™ provou que √© poss√≠vel prosperar cuidando do planeta.",
                    winCondition: (s) => s.sustainability >= 100 && s.reputation >= 90,
                    getWinMessage: (s) => `PARAB√âNS! Voc√™ atingiu ${s.sustainability} de Sustentabilidade e ${s.reputation} de Reputa√ß√£o!`
                },
                capitalista: {
                    name: "Capitalista Consciente üí∞",
                    description: "Resultados financeiros impressionantes! Voc√™ soube aliar lucro com responsabilidade.",
                    winCondition: (s) => s.budget >= 5000 && s.sustainability >= 60,
                    getWinMessage: (s) => `PARAB√âNS! Voc√™ atingiu ${Helpers.formatCurrency(s.budget)} em caixa e ${s.sustainability} de Sustentabilidade!`
                },
                lider: {
                    name: "L√≠der Comunit√°rio üë®‚Äçüë©‚Äçüëß‚Äçüë¶",
                    description: "Sua f√°brica √© o orgulho da comunidade! Sua gest√£o focada em pessoas e reputa√ß√£o criou um ambiente exemplar.",
                    winCondition: (s) => s.morale >= 100 && s.reputation >= 95,
                    getWinMessage: (s) => `PARAB√âNS! Voc√™ atingiu ${s.morale} de Moral e ${s.reputation} de Reputa√ß√£o!`
                }
            },
            
            // √Årvore de Pesquisa (P&D) - Agora com Tiers e Depend√™ncias
            researchTree: {
                // Tier 1: Pesquisas B√°sicas
                t1_basic_recycling: {
                    id: 't1_basic_recycling',
                    label: "P&D: Reciclagem B√°sica",
                    costRP: 5,
                    description: "Estuda m√©todos simples de separa√ß√£o e reuso de res√≠duos.",
                    effects: { sustainability: 5 },
                    unlocksActions: ['action_implement_basic_recycling'],
                    requiredTech: []
                },
                t1_efficiency_studies: {
                    id: 't1_efficiency_studies',
                    label: "P&D: Estudos de Efici√™ncia",
                    costRP: 5,
                    description: "Analisa o fluxo de trabalho para reduzir desperd√≠cio de tempo e material.",
                    effects: { production: 5 },
                    unlocksActions: ['action_team_training_efficiency'],
                    requiredTech: []
                },
                t1_local_marketing: {
                    id: 't1_local_marketing',
                    label: "P&D: Marketing Comunit√°rio",
                    costRP: 3,
                    description: "Entende como melhorar a imagem da f√°brica na comunidade local.",
                    effects: { reputation: 5 },
                    unlocksActions: ['action_sponsor_local_team', 'action_community_open_day'],
                    requiredTech: []
                },
                
                // Tier 2: Pesquisas Intermedi√°rias
                t2_water_optimization: {
                    id: 't2_water_optimization',
                    label: "P&D: Otimiza√ß√£o de √Ågua",
                    costRP: 10,
                    description: "Pesquisa sobre reuso de √°gua e sistemas de irriga√ß√£o eficientes.",
                    effects: { sustainability: 5 },
                    unlocksActions: ['action_install_water_reuse_system'],
                    requiredTech: ['t1_basic_recycling'] // Precisa de reciclagem b√°sica primeiro
                },
                t2_green_energy: {
                    id: 't2_green_energy',
                    label: "P&D: Estudo de Energia Limpa",
                    costRP: 12,
                    description: "Analisa a viabilidade de pain√©is solares e outras fontes limpas.",
                    effects: {},
                    unlocksActions: ['action_install_solar_panels'],
                    requiredTech: ['t1_efficiency_studies']
                },
                t2_hr_development: {
                    id: 't2_hr_development',
                    label: "P&D: Desenvolvimento de RH",
                    costRP: 8,
                    description: "Estuda pol√≠ticas de b√¥nus, sa√∫de e bem-estar para a equipe.",
                    effects: { morale: 5 },
                    unlocksActions: ['action_profit_sharing_plan', 'action_health_plan'],
                    requiredTech: ['t1_local_marketing']
                },

                // Tier 3: Pesquisas Avan√ßadas
                t3_advanced_recycling: {
                    id: 't3_advanced_recycling',
                    label: "P&D: Reciclagem Avan√ßada",
                    costRP: 20,
                    description: "Desenvolve tecnologia para 'lixo zero', transformando 100% do res√≠duo.",
                    effects: { sustainability: 10 },
                    unlocksActions: ['action_zero_waste_plant'],
                    requiredTech: ['t2_water_optimization']
                },
                t3_automation: {
                    id: 't3_automation',
                    label: "P&D: Automa√ß√£o de Linha",
                    costRP: 25,
                    description: "Implementa rob√¥s para acelerar a produ√ß√£o (cuidado com a moral!).",
                    effects: { production: 10 },
                    unlocksActions: ['action_automate_production_line'],
                    requiredTech: ['t2_green_energy']
                },
                t3_brand_strategy: {
                    id: 't3_brand_strategy',
                    label: "P&D: Estrat√©gia de Marca",
                    costRP: 15,
                    description: "Cria uma marca forte e reconhecida nacionalmente.",
                    effects: { reputation: 10 },
                    unlocksActions: ['action_national_marketing_campaign'],
                    requiredTech: ['t2_hr_development']
                }
            },
            
            // A√ß√µes de Gest√£o (Desbloqueadas por P&D ou padr√£o)
            actions: {
                // A√ß√µes Iniciais (Dispon√≠veis no come√ßo)
                action_improve_breakroom: {
                    id: 'action_improve_breakroom',
                    label: "Melhorar Refeit√≥rio",
                    cost: 150,
                    description: "Caf√© de melhor qualidade e um espa√ßo mais confort√°vel. Aumenta a moral.",
                    effects: { morale: 10, waste: 1 },
                    requiredTech: []
                },
                action_optimize_logistics: {
                    id: 'action_optimize_logistics',
                    label: "Otimizar Log√≠stica",
                    cost: 200,
                    description: "Revisar rotas de entrega para economizar combust√≠vel e tempo.",
                    effects: { budget: 50, sustainability: 5 }, // +50/m√™s (simulado no c√°lculo de renda)
                    isMonthlyEffect: true, // Indica que o efeito √© recorrente
                    monthlyEffects: { budget_income: 50 }
                },
                action_buy_more_land: {
                    id: 'action_buy_more_land',
                    label: "Comprar Mais Terra (5ha)",
                    cost: 300,
                    description: "Expande a √°rea agr√≠cola, aumentando o potencial de produ√ß√£o.",
                    effects: { land: 5, production: 5, waste: 2 },
                    requiredTech: []
                },
                action_protect_from_frost: {
                    id: 'action_protect_from_frost',
                    label: "Instalar Estufas Protetoras",
                    cost: 400,
                    description: "Protege a planta√ß√£o de geadas, reduzindo perdas.",
                    effects: { sustainability: 5 },
                    unlocksFlag: 'frostProtection', // Flag para evento
                    requiredTech: []
                },

                // A√ß√µes TIER 1 (Desbloqueadas por P&D T1)
                action_implement_basic_recycling: {
                    id: 'action_implement_basic_recycling',
                    label: "Implementar Reciclagem B√°sica",
                    cost: 300,
                    description: "Instala lixeiras de separa√ß√£o e processos de reuso.",
                    effects: { waste: -15, sustainability: 15, morale: 5 },
                    requiredTech: ['t1_basic_recycling']
                },
                action_team_training_efficiency: {
                    id: 'action_team_training_efficiency',
                    label: "Capacitar Equipe (Efici√™ncia)",
                    cost: 250,
                    description: "Treinamento para reduzir desperd√≠cio na linha de produ√ß√£o.",
                    effects: { production: 10, morale: 10, waste: -5 },
                    requiredTech: ['t1_efficiency_studies']
                },
                action_sponsor_local_team: {
                    id: 'action_sponsor_local_team',
                    label: "Patrocinar Time Local",
                    cost: 200,
                    description: "Coloca o logo da f√°brica na camiseta do time de futebol da cidade.",
                    effects: { morale: 5, reputation: 15 },
                    requiredTech: ['t1_local_marketing']
                },
                action_community_open_day: {
                    id: 'action_community_open_day',
                    label: "Dia de F√°brica Aberta",
                    cost: 100,
                    description: "Convida a comunidade para visitar a f√°brica.",
                    effects: { reputation: 10 },
                    requiredTech: ['t1_local_marketing']
                },

                // A√ß√µes TIER 2
                action_install_water_reuse_system: {
                    id: 'action_install_water_reuse_system',
                    label: "Instalar Reuso de √Ågua",
                    cost: 600,
                    description: "Sistema de ciclo fechado que economiza milhares de litros.",
                    effects: { waste: -10, sustainability: 20 },
                    requiredTech: ['t2_water_optimization']
                },
                action_install_solar_panels: {
                    id: 'action_install_solar_panels',
                    label: "Instalar Energia Solar (Pequena)",
                    cost: 1000,
                    description: "Cobre 30% da demanda de energia com pain√©is solares.",
                    effects: { sustainability: 30, reputation: 10, waste: -5 },
                    monthlyEffects: { budget_income: 100 }, // Economia de energia
                    requiredTech: ['t2_green_energy']
                },
                action_profit_sharing_plan: {
                    id: 'action_profit_sharing_plan',
                    label: "Plano de Participa√ß√£o nos Lucros",
                    cost: 500, // Custo inicial de implementa√ß√£o
                    description: "Divide uma pequena parte dos lucros com a equipe.",
                    effects: { morale: 25, production: 5 },
                    monthlyEffects: { budget_expense: 100 }, // Custo recorrente
                    requiredTech: ['t2_hr_development']
                },
                action_health_plan: {
                    id: 'action_health_plan',
                    label: "Oferecer Plano de Sa√∫de B√°sico",
                    cost: 300,
                    description: "Plano de sa√∫de para todos os funcion√°rios.",
                    effects: { morale: 20 },
                    monthlyEffects: { budget_expense: 50 },
                    requiredTech: ['t2_hr_development']
                },

                // A√ß√µes TIER 3 (Fim de Jogo)
                action_zero_waste_plant: {
                    id: 'action_zero_waste_plant',
                    label: "Converter para 'Lixo Zero'",
                    cost: 2500,
                    description: "Investimento massivo para eliminar 100% do desperd√≠cio.",
                    effects: { waste: -50, sustainability: 40, reputation: 20 },
                    requiredTech: ['t3_advanced_recycling']
                },
                action_automate_production_line: {
                    id: 'action_automate_production_line',
                    label: "Automatizar Linha de Produ√ß√£o",
                    cost: 2000,
                    description: "Aumenta drasticamente a produ√ß√£o, mas pode reduzir a moral.",
                    effects: { production: 50, morale: -20, waste: 5 },
                    requiredTech: ['t3_automation']
                },
                action_national_marketing_campaign: {
                    id: 'action_national_marketing_campaign',
                    label: "Campanha de Marketing Nacional",
                    cost: 1500,
                    description: "Torna a 'EcoF√°brica' uma marca reconhecida no Brasil.",
                    effects: { reputation: 30 },
                    monthlyEffects: { marketPriceModifier: 0.2 }, // Aumenta o pre√ßo dos produtos
                    requiredTech: ['t3_brand_strategy']
                }
            },
            
            // Eventos Aleat√≥rios (Mais complexos e frequentes)
            events: [
                // Eventos Negativos
                {
                    id: "GEADA",
                    title: "Alerta de Geada Severa!",
                    // Condi√ß√£o: Meses 6 ou 7 (Inverno), se N√ÉO tiver prote√ß√£o
                    condition: (s) => (s.currentMonth === 6 || s.currentMonth === 7) && !s.unlockedFlags.frostProtection && Math.random() < 0.6,
                    message: "Uma frente fria intensa vinda do Sul amea√ßa congelar sua produ√ß√£o agr√≠cola. Suas planta√ß√µes est√£o vulner√°veis!",
                    choices: [
                        { text: "Sofrer o impacto total", effects: { production: -20, budget: -150 }, log: "A geada foi devastadora. Perdemos parte da produ√ß√£o." },
                        { text: "Tentar salvar parte (Gastar $100)", cost: 100, effects: { production: -10, budget: -50 }, log: "Conseguimos salvar parte da colheita, mas tivemos custos emergenciais." }
                    ]
                },
                {
                    id: "ESTIAGEM",
                    title: "Estiagem Severa!",
                    // Condi√ß√£o: Meses 1, 2, 11, 12 (Ver√£o)
                    condition: (s) => (s.currentMonth === 1 || s.currentMonth === 2 || s.currentMonth === 11 || s.currentMonth === 12) && !s.unlockedTech.includes('t2_water_optimization') && Math.random() < 0.4,
                    message: "A falta de chuva no Paran√° est√° cr√≠tica, afetando o n√≠vel dos reservat√≥rios e sua produ√ß√£o.",
                    choices: [
                        { text: "Aceitar consequ√™ncias", effects: { production: -15, waste: 5, budget: -100 }, log: "A estiagem impactou a produ√ß√£o e aumentou os custos." }
                    ]
                },
                {
                    id: "FISCALIZACAO",
                    title: "Fiscaliza√ß√£o Ambiental!",
                    // Condi√ß√£o: Se o desperd√≠cio for alto
                    condition: (s) => s.waste > 50 && s.sustainability < 30 && Math.random() < 0.3,
                    message: "Fiscais do Instituto √Ågua e Terra (IAT) est√£o na f√°brica. Eles encontraram irregularidades no descarte de res√≠duos.",
                    choices: [
                        { text: "Pagar multa e se adequar ($300)", cost: 300, effects: { reputation: -10, sustainability: -5 }, log: "Multa paga. Tivemos que nos adequar √†s pressas." },
                        { text: "Tentar subornar o fiscal ($150)", cost: 150, effects: { reputation: -30, sustainability: -10, morale: -10 }, log: "O fiscal n√£o aceitou! O esc√¢ndalo manchou a reputa√ß√£o da f√°brica." },
                        { text: "Negociar um Termo de Ajuste ($50)", cost: 50, effects: { reputation: -5 }, log: "Negociamos um TAC. A multa foi baixa, mas teremos que investir em P&D 't1_basic_recycling' no pr√≥ximo m√™s." }
                    ]
                },
                {
                    id: "EQUIPE_DOENTE",
                    title: "Surto de Gripe na Equipe",
                    // Condi√ß√£o: Se a moral for baixa
                    condition: (s) => s.morale < 50 && !s.unlockedActions.includes('action_health_plan') && Math.random() < 0.3,
                    message: "Com a moral baixa e o inverno chegando, um surto de gripe afastou 15% da sua equipe.",
                    choices: [
                        { text: "Contratar tempor√°rios ($200)", cost: 200, effects: { production: -5, morale: -5 }, log: "Contratamos tempor√°rios, mas a produ√ß√£o caiu e a equipe ficou sobrecarregada." },
                        { text: "Absorver a perda", effects: { production: -15, morale: -10, budget: -50 }, log: "N√£o fizemos nada e a produ√ß√£o do m√™s foi muito prejudicada." }
                    ]
                },
                
                // Eventos Positivos
                {
                    id: "MIDIA_POSITIVA",
                    title: "Reportagem Local Positiva!",
                    // Condi√ß√£o: Se a reputa√ß√£o for boa
                    condition: (s) => s.reputation > 60 && s.sustainability > 50 && Math.random() < 0.25,
                    message: "Um jornal local fez uma reportagem elogiando as pr√°ticas sustent√°veis da EcoF√°brica! O p√∫blico adorou.",
                    choices: [
                        { text: "Agradecer e continuar", effects: { reputation: 15, morale: 10, marketPriceModifier: 0.1 }, log: "A reportagem positiva aumentou nossa reputa√ß√£o e o pre√ßo dos produtos!" }
                    ]
                },
                {
                    id: "INOVACAO_INTERNA",
                    title: "Ideia Brilhante da Equipe!",
                    // Condi√ß√£o: Se a moral for alta
                    condition: (s) => s.morale > 75 && Math.random() < 0.2,
                    message: "Com a equipe motivada, um funcion√°rio sugeriu uma pequena mudan√ßa no processo que pode economizar muito!",
                    choices: [
                        { text: "Implementar e dar b√¥nus ($100)", cost: 100, effects: { morale: 10, researchPoints: 5, waste: -10 }, log: "A ideia foi um sucesso e a equipe se sente valorizada!" },
                        { text: "Implementar e ignorar o funcion√°rio", effects: { morale: -15, researchPoints: 5, waste: -10 }, log: "A ideia funcionou, mas a equipe ficou desmotivada por n√£o ser reconhecida." }
                    ]
                },
                {
                    id: "PREMIO_PREFEITURA",
                    title: "Pr√™mio 'Empresa Amiga da Cidade'",
                    // Condi√ß√£o: Se tiver P&D de marketing
                    condition: (s) => s.reputation > 50 && s.unlockedTech.includes('t1_local_marketing') && Math.random() < 0.15,
                    message: "A prefeitura reconheceu seus esfor√ßos comunit√°rios e concedeu √† f√°brica um pr√™mio e um pequeno incentivo fiscal.",
                    choices: [
                        { text: "Receber pr√™mio! (+$300)", cost: -300, effects: { reputation: 10, morale: 5 }, log: "Ganhamos +$300 de incentivo e nossa reputa√ß√£o melhorou!" }
                    ]
                }
            ]
        };


        /* ==========================================================================
           VIRTUAL FILE: /js/core/State.js
           DESCRI√á√ÉO: Classe que gerencia TODO o estado (dados) do jogo.
                      N√£o mexe no HTML. Apenas calcula e guarda dados.
           ========================================================================== */
        
        // PROFESSOR SABI√Å: 
        // Esta classe, 'GameState', √© o "Modelo" (o 'M' do MVC).
        // Ela √© o √öNICO lugar que sabe qual √© o seu or√ßamento, sua moral, etc.
        // √â a "fonte da verdade". Fun√ß√µes externas v√£o *perguntar* a ela
        // ou *pedir* para ela mudar um valor.
        
        class GameState {
            constructor() {
                // Estado inicial
                this.currentState = { ...GAME_DATA.initialState };
                this.playerName = "Gestor(a)";
                this.managerProfile = null; // 'visionario', 'capitalista', 'lider'
                this.currentMonth = 0;
                this.isEventActive = false;
                
                // Guarda tecnologias de P&D pesquisadas
                this.unlockedTech = []; 
                // Guarda a√ß√µes de gest√£o j√° compradas
                this.unlockedActions = [];
                // Guarda flags especiais (ex: 'frostProtection')
                this.unlockedFlags = {};
                
                // Efeitos recorrentes (ex: +$50/m√™s de log√≠stica)
                this.monthlyEffects = {
                    budget_income: 0,
                    budget_expense: 0,
                    marketPriceModifier: 0.0
                };
                
                // Hist√≥rico para o gr√°fico de relat√≥rio
                this.history = {
                    budget: [],
                    sustainability: [],
                    waste: []
                };
            }
            
            /** Retorna o objeto de estado atual (imut√°vel) */
            get() {
                // PROFESSOR SABI√Å: 
                // Usamos '{ ...this.currentState }' (Spread Operator)
                // para enviar uma *c√≥pia* do estado, n√£o o original.
                // Isso √© uma boa pr√°tica para evitar que outras partes
                // do c√≥digo modifiquem o estado "por baixo dos panos".
                return { 
                    ...this.currentState,
                    playerName: this.playerName,
                    managerProfile: this.managerProfile,
                    currentMonth: this.currentMonth,
                    unlockedTech: this.unlockedTech,
                    unlockedActions: this.unlockedActions
                };
            }
            
            /** Inicia o estado do jogo com base na sele√ß√£o do jogador */
            initialize(playerName, profileId) {
                this.playerName = playerName || "Gestor(a) Consciente";
                this.managerProfile = profileId;
                this.currentState = { ...GAME_DATA.initialState };
                
                // Reset de vari√°veis de controle
                this.currentMonth = 0;
                this.isEventActive = false;
                this.unlockedTech = [];
                this.unlockedActions = [];
                this.unlockedFlags = {};
                this.monthlyEffects = { budget_income: 0, budget_expense: 0, marketPriceModifier: 0.0 };
                this.history = { budget: [], sustainability: [], waste: [] };

                // B√¥nus inicial baseado no perfil (Exemplo)
                if (profileId === 'visionario') {
                    this.currentState.sustainability += 10;
                    this.currentState.researchPoints += 3;
                } else if (profileId === 'capitalista') {
                    this.currentState.budget += 300;
                } else if (profileId === 'lider') {
                    this.currentState.morale += 10;
                    this.currentState.reputation += 5;
                }
            }
            
            /**
             * Aplica os efeitos de uma a√ß√£o ou P&D
             * @param {object} item - O objeto de A√ß√£o ou P&D
             */
            applyItemEffects(item) {
                const s = this.currentState;

                // 1. Custos
                if (item.cost) s.budget -= item.cost;
                if (item.costRP) s.researchPoints -= item.costRP;
                
                // 2. Efeitos Imediatos (ex: +10 moral)
                if (item.effects) {
                    for (const key in item.effects) {
                        s[key] = (s[key] || 0) + item.effects[key];
                    }
                }
                
                // 3. Efeitos Recorrentes (ex: +$50/m√™s)
                if (item.monthlyEffects) {
                    for (const key in item.monthlyEffects) {
                        this.monthlyEffects[key] = (this.monthlyEffects[key] || 0) + item.monthlyEffects[key];
                    }
                }
                
                // 4. Desbloqueios
                if (item.id) {
                    if (item.costRP) this.unlockedTech.push(item.id);
                    else this.unlockedActions.push(item.id);
                }
                if (item.unlocksFlag) {
                    this.unlockedFlags[item.unlocksFlag] = true;
                }
                
                // 5. Garantir que os valores fiquem nos limites (0-100)
                this.clampStats();
            }
            
            /** Aplica os efeitos da escolha de um evento */
            applyEventChoice(choice) {
                const s = this.currentState;
                if (choice.cost) s.budget -= choice.cost;
                if (choice.effects) {
                    for (const key in choice.effects) {
                        s[key] = (s[key] || 0) + choice.effects[key];
                    }
                }
                this.clampStats();
            }

            /**
             * A principal fun√ß√£o de c√°lculo do jogo. Roda a cada m√™s.
             */
            processMonthlyTurn() {
                this.currentMonth++;
                const s = this.currentState;
                
                // 1. Grava hist√≥rico (para o gr√°fico)
                this.history.budget.push(s.budget);
                this.history.sustainability.push(s.sustainability);
                this.history.waste.push(s.waste);

                // 2. C√°lculo de Receita (Income)
                const basePrice = 15; // Pre√ßo base por unidade de produ√ß√£o
                const marketMod = s.marketPriceModifier + this.monthlyEffects.marketPriceModifier;
                // B√¥nus de pre√ßo por reputa√ß√£o e sustentabilidade
                const premiumMod = 1 + (s.reputation / 200) + (s.sustainability / 250);
                const income = s.production * basePrice * marketMod * premiumMod;

                // 3. C√°lculo de Despesas (Expenses)
                const wasteCost = s.waste * 5; // Custo por unidade de lixo
                const productionCost = s.production * 3; // Custo operacional
                const landCost = s.land * 5; // Custo de manuten√ß√£o da terra
                const moraleCost = Math.max(0, (100 - s.morale) * 2); // Custo de baixa moral (turnover, etc)
                const expenses = wasteCost + productionCost + landCost + moraleCost;

                // 4. Aplicar efeitos recorrentes
                const netMonthlyEffects = this.monthlyEffects.budget_income - this.monthlyEffects.budget_expense;
                
                // 5. Atualizar Or√ßamento
                const profit = income - expenses + netMonthlyEffects;
                s.budget += profit;
                
                // 6. Atualiza√ß√µes Passivas
                // Ganha P&D (mais se a moral for alta)
                s.researchPoints += (s.morale > 75 ? 3 : (s.morale > 50 ? 2 : 1));
                // Moral e Reputa√ß√£o tendem a "normalizar" (drift)
                s.morale += (Math.random() * 4 - 2); // Flutua√ß√£o de -2 a +2
                s.reputation -= 1; // Reputa√ß√£o cai se n√£o for mantida
                
                // 7. Aplicar limites
                this.clampStats();
                
                // Retorna um resumo do m√™s para o Log
                return { income, expenses, netMonthlyEffects, profit };
            }
            
            /** Verifica se h√° um evento aleat√≥rio para este m√™s */
            checkForRandomEvent() {
                const s = this.get(); // Pega o estado atual
                
                const potentialEvents = GAME_DATA.events.filter(event => {
                    // PROFESSOR SABI√Å: 
                    // Isso √© JS funcional! Usamos '.filter()' para criar
                    // um NOVO array s√≥ com os eventos cuja 'condition' (condi√ß√£o)
                    // retorna 'true'. √â muito elegante!
                    return event.condition(s);
                });
                
                if (potentialEvents.length > 0) {
                    // Pega um evento aleat√≥rio da lista de poss√≠veis
                    return Helpers.getRandomItem(potentialEvents);
                }
                return null; // Nenhum evento este m√™s
            }
            
            /** Garante que as estat√≠sticas fiquem entre 0 e 100 (ou mais, se necess√°rio) */
            clampStats() {
                const s = this.currentState;
                s.sustainability = Helpers.clamp(s.sustainability, 0, 100);
                s.morale = Helpers.clamp(s.morale, 0, 100);
                s.reputation = Helpers.clamp(s.reputation, 0, 100);
                s.waste = Math.max(0, s.waste);
                s.production = Math.max(0, s.production);
                s.researchPoints = Math.max(0, s.researchPoints);
                s.budget = Math.round(s.budget);
            }
            
            /** Verifica a condi√ß√£o de vit√≥ria */
            checkWinCondition() {
                const profile = GAME_DATA.profiles[this.managerProfile];
                if (!profile) return false;
                return profile.winCondition(this.currentState);
            }
            
            /** Retorna a mensagem de vit√≥ria ou derrota */
            getFinalMessage(isBankruptcy) {
                if (isBankruptcy) {
                    return `Que pena... A ECOF√ÅBRICA faliu no M√™s ${this.currentMonth}. Mas n√£o desanime, toda jornada tem seus trope√ßos. Tente novamente!`;
                }
                
                const profile = GAME_DATA.profiles[this.managerProfile];
                const didWin = this.checkWinCondition();
                
                if (didWin) {
                    const winMsg = profile.getWinMessage(this.currentState);
                    return `PARAB√âNS, ${this.playerName}! Voc√™ atingiu sua meta como ${profile.name}! ${winMsg} ${profile.description}`;
                } else {
                    return `A gest√£o foi um grande aprendizado, ${this.playerName}. Voc√™ n√£o atingiu a meta de ${profile.name}, mas cada desafio ensina. Tente novamente!`;
                }
            }
        }


        /* ==========================================================================
           VIRTUAL FILE: /js/core/UI.js
           DESCRI√á√ÉO: Classe que gerencia TODA a intera√ß√£o com o DOM (HTML).
                      L√™ o estado e atualiza a tela. N√£o faz c√°lculos.
           ========================================================================== */
        
        // PROFESSOR SABI√Å: 
        // Esta classe, 'GameUI', √© a "Vis√£o" (o 'V' do MVC).
        // Sua √∫nica tarefa √©: "Olhar para o objeto 'State' e desenhar a tela".
        // Ela n√£o sabe *por que* o or√ßamento mudou. Ela s√≥ v√™
        // 'state.budget = 500' e atualiza o HTML para 'R$ 500'.
        // Isso se chama "Decoupling" (Desacoplamento).
        
        class GameUI {
            constructor() {
                // "Cache" de seletores do DOM.
                // PROFESSOR SABI√Å: 
                // Guardamos os elementos em 'this.dom' no in√≠cio
                // para n√£o ter que ficar chamando 'document.getElementById'
                // toda hora. √â muito mais r√°pido (perform√°tico)!
                this.dom = {
                    // Telas
                    startScreen: document.getElementById('start-screen'),
                    gameScreen: document.getElementById('game-screen'),
                    endScreen: document.getElementById('end-screen'),
                    
                    // Cabe√ßalho
                    gameHeader: document.getElementById('game-header'),
                    
                    // Tela Inicial
                    playerNameInput: document.getElementById('player-name-input'),
                    profileButtons: document.querySelectorAll('.c-btn--profile'),
                    startButton: document.getElementById('start-button'),
                    
                    // Tela do Jogo
                    statsGrid: document.getElementById('stats-grid'),
                    decisionsColumn: document.getElementById('decisions-column'),
                    researchColumn: document.getElementById('research-column'),
                    nextMonthButton: document.getElementById('next-month-button'),
                    showReportButton: document.getElementById('show-report-button'),
                    gameLog: document.getElementById('game-log'),
                    
                    // Mentor (Sabi√°)
                    sabiaMentorBox: document.getElementById('sabia-mentor-ui'),
                    sabiaTipTitle: document.getElementById('sabia-tip-title'),
                    sabiaTipText: document.getElementById('sabia-tip-text'),

                    // Tela Final
                    finalStatsGrid: document.getElementById('final-stats-grid'),
                    finalMessage: document.getElementById('final-message'),
                    restartButton: document.getElementById('restart-button'),
                    
                    // Modais
                    reportModal: document.getElementById('report-modal'),
                    eventModal: document.getElementById('event-modal'),
                    sabiaQuizModal: document.getElementById('sabia-quiz-modal'),
                    closeModalButtons: document.querySelectorAll('.c-modal__close-btn'),
                    
                    // Conte√∫do dos Modais
                    chartContainer: document.getElementById('chart-container'),
                    eventModalTitle: document.getElementById('event-modal-title'),
                    eventModalMessage: document.getElementById('event-modal-message'),
                    eventModalChoices: document.getElementById('event-modal-choices'),
                    sabiaQuizQuestion: document.getElementById('sabia-quiz-question'),
                    sabiaQuizChoices: document.getElementById('sabia-quiz-choices'),
                    sabiaQuizFeedback: document.getElementById('sabia-quiz-feedback'),
                    
                    // Controles
                    music: {
                        audio: document.getElementById('background-music'),
                        toggleBtn: document.getElementById('music-toggle')
                    }
                };
                
                // Vari√°vel para controlar a m√∫sica
                this.isMusicPlaying = false;
            }
            
            /** Adiciona todos os event listeners da UI */
            bindEvents(gameInstance) {
                // PROFESSOR SABI√Å: 
                // 'gameInstance' √© o objeto 'Game' (nosso controlador).
                // A UI n√£o sabe o que 'handleAction' faz, ela s√≥
                // avisa o 'Game': "Ei, o usu√°rio clicou em uma a√ß√£o!".
                // Isso √© "Inje√ß√£o de Depend√™ncia".
                
                // Tela Inicial
                this.dom.profileButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        this.dom.profileButtons.forEach(btn => btn.classList.remove('is-selected'));
                        button.classList.add('is-selected');
                        this.dom.startButton.disabled = false;
                    });
                });
                
                this.dom.startButton.addEventListener('click', () => {
                    const name = this.dom.playerNameInput.value;
                    const profile = document.querySelector('.c-btn--profile.is-selected')?.dataset.profile;
                    if (profile) {
                        gameInstance.startGame(name, profile);
                    }
                });
                
                // Controles do Jogo
                this.dom.nextMonthButton.addEventListener('click', () => gameInstance.advanceMonth());
                this.dom.showReportButton.addEventListener('click', () => gameInstance.showReport());
                this.dom.restartButton.addEventListener('click', () => window.location.reload());
                
                // Listeners de A√ß√£o e P&D (Usando Delega√ß√£o de Evento)
                // PROFESSOR SABI√Å: 
                // "Delega√ß√£o de Evento" √© uma t√©cnica PRO.
                // Em vez de adicionar 30 listeners (um para cada bot√£o),
                // adicionamos UM listener no "pai" (a coluna).
                // O pai "escuta" o clique e v√™ se ele veio de um
                // bot√£o com 'data-action-id'. √â muito mais perform√°tico!
                this.dom.decisionsColumn.addEventListener('click', (e) => {
                    const button = e.target.closest('button[data-action-id]');
                    if (button && !button.disabled) {
                        gameInstance.handleAction(button.dataset.actionId);
                    }
                });
                
                this.dom.researchColumn.addEventListener('click', (e) => {
                    const button = e.target.closest('button[data-research-id]');
                    if (button && !button.disabled) {
                        gameInstance.handleResearch(button.dataset.researchId);
                    }
                });

                // Modais
                this.dom.closeModalButtons.forEach(btn => {
                    btn.addEventListener('click', () => {
                        const modalId = btn.dataset.modalId;
                        if (modalId) {
                            this.showModal(modalId, false);
                        }
                    });
                });
                
                // Fechar modal clicando fora
                window.addEventListener('click', (event) => {
                    if (event.target.classList.contains('c-modal')) {
                        const modalId = event.target.id;
                        if (modalId !== 'event-modal') { // Eventos n√£o podem ser fechados clicando fora
                            this.showModal(modalId, false);
                        }
                    }
                });
                
                // Controle de M√∫sica
                this.dom.music.toggleBtn.addEventListener('click', () => this.toggleMusic());
            }

            /** Alterna entre telas (start, game, end) */
            switchScreen(screenName) {
                this.dom.startScreen.classList.add('u-hidden');
                this.dom.gameScreen.classList.add('u-hidden');
                this.dom.endScreen.classList.add('u-hidden');
                
                if (screenName === 'game') {
                    this.dom.gameScreen.classList.remove('u-hidden');
                } else if (screenName === 'end') {
                    this.dom.endScreen.classList.remove('u-hidden');
                } else {
                    this.dom.startScreen.classList.remove('u-hidden');
                }
            }
            
            /** Toca ou pausa a m√∫sica de fundo */
            toggleMusic(forcePlay = false) {
                if (forcePlay && !this.isMusicPlaying) {
                    this.dom.music.audio.volume = 0.2;
                    this.dom.music.audio.play().catch(e => console.warn("M√∫sica aguardando intera√ß√£o do usu√°rio."));
                    this.dom.music.toggleBtn.textContent = 'üéµ';
                    this.isMusicPlaying = true;
                } else if (!forcePlay) {
                    if (this.dom.music.audio.paused) {
                        this.dom.music.audio.play();
                        this.dom.music.toggleBtn.textContent = 'üéµ';
                        this.isMusicPlaying = true;
                    } else {
                        this.dom.music.audio.pause();
                        this.dom.music.toggleBtn.textContent = 'üîá';
                        this.isMusicPlaying = false;
                    }
                }
            }

            /**
             * A principal fun√ß√£o de renderiza√ß√£o. Chamada todo m√™s.
             * @param {object} state - O objeto de estado (vinda de state.get())
             */
            render(state, history, isEventActive) {
                // 1. Renderiza Cabe√ßalho
                this.dom.gameHeader.innerHTML = `Gestor(a) <strong>${state.playerName}</strong> - M√™s: <strong>${state.currentMonth}</strong> / ${GAME_DATA.totalMonths}`;
                
                // 2. Renderiza Stats
                this.renderStats(state, this.dom.statsGrid);
                
                // 3. Renderiza A√ß√µes e P&D
                this.renderActions(state);
                this.renderResearch(state);
                
                // 4. Atualiza estado dos bot√µes (desabilitar/habilitar)
                this.updateButtonStates(state, isEventActive);
            }
            
            /** Renderiza o grid de estat√≠sticas */
            renderStats(state, targetElement) {
                targetElement.innerHTML = ''; // Limpa o grid
                const displayNames = GAME_DATA.statDisplayNames;
                
                // PROFESSOR SABI√Å: 
                // 'Object.keys(displayNames)' pega todas as "chaves"
                // (ex: 'budget', 'production') do objeto.
                // Usamos 'forEach' para "varrer" esse array e criar
                // um item de stat para cada chave.
                
                Object.keys(displayNames).forEach(key => {
                    if (state.hasOwnProperty(key)) {
                        const name = displayNames[key];
                        const value = state[key];
                        let valueStr = "";
                        
                        // Formata√ß√£o especial
                        if (key === 'budget') {
                            valueStr = Helpers.formatCurrency(value);
                        } else if (key === 'marketPriceModifier') {
                            valueStr = `${(value * 100).toFixed(0)}%`;
                        } else if (key.match(/sustainability|morale|reputation/)) {
                            valueStr = `${value.toFixed(0)} / 100`;
                        } else {
                            valueStr = value.toFixed(0);
                        }
                        
                        // Cria√ß√£o do HTML
                        const statItem = document.createElement('div');
                        statItem.className = 'c-stats-grid__item';
                        
                        // Adiciona classe modificadora para cor
                        const modifierClass = `c-stats-grid__value--${key}`;
                        
                        statItem.innerHTML = `
                            <span class="c-stats-grid__label">${name}</span>
                            <span class="c-stats-grid__value ${modifierClass}">${valueStr}</span>
                        `;
                        targetElement.appendChild(statItem);
                    }
                });
            }
            
            /** Renderiza os bot√µes de A√ß√µes (Decis√µes) */
            renderActions(state) {
                this.dom.decisionsColumn.innerHTML = '<h4>Tomada de Decis√£o (A√ß√µes)</h4>'; // Limpa
                
                Object.values(GAME_DATA.actions).forEach(action => {
                    // Verifica se j√° foi comprada (se for "compr√°vel" 1x)
                    if (action.unlocksFlag && state.unlockedFlags[action.unlocksFlag]) return;
                    if (!action.isMonthlyEffect && state.unlockedActions.includes(action.id)) return;
                    
                    // Verifica se tem a P&D necess√°ria
                    const hasTech = action.requiredTech.every(techId => state.unlockedTech.includes(techId));
                    if (!hasTech) return; // Esconde o bot√£o se n√£o tiver a P&D

                    this.dom.decisionsColumn.appendChild(
                        this.createActionButton(action, 'action', state)
                    );
                });
            }
            
            /** Renderiza os bot√µes de P&D (Pesquisa) */
            renderResearch(state) {
                this.dom.researchColumn.innerHTML = '<h4>Pesquisa & Desenvolvimento (P&D)</h4>';
                
                Object.values(GAME_DATA.researchTree).forEach(tech => {
                    // Verifica se j√° foi pesquisada
                    if (state.unlockedTech.includes(tech.id)) return;
                    
                    // Verifica se tem a P&D pr√©-requisito
                    const hasRequiredTech = tech.requiredTech.every(reqId => state.unlockedTech.includes(reqId));
                    if (!hasRequiredTech) return; // Esconde se n√£o tiver o pr√©-requisito
                    
                    this.dom.researchColumn.appendChild(
                        this.createActionButton(tech, 'research', state)
                    );
                });
            }
            
            /** Fun√ß√£o auxiliar para criar bot√µes de a√ß√£o/P&D */
            createActionButton(item, type, state) {
                const button = document.createElement('button');
                const isResearch = type === 'research';
                
                button.dataset[isResearch ? 'researchId' : 'actionId'] = item.id;
                button.className = `c-btn c-btn--action ${isResearch ? 'c-btn--research' : 'c-btn--decision'}`;
                
                const cost = item.cost || 0;
                const costRP = item.costRP || 0;
                
                // Verifica custos
                let reason = "";
                if (state.budget < cost) reason = "Or√ßamento insuficiente";
                else if (state.researchPoints < costRP) reason = "P&D insuficiente";
                
                button.disabled = reason !== "";
                button.title = reason || item.description;
                
                // PROFESSOR SABI√Å: 
                // 'Template Literals' (o texto com `...`) s√£o fant√°sticos!
                // Eles nos deixam injetar vari√°veis (ex: ${item.label})
                // diretamente na string. Muito melhor que ficar
                // concatenando com '+'.
                
                button.innerHTML = `
                    <strong>${item.label}</strong>
                    <small>
                        ${item.description}
                        <br>
                        Custo: <span class="cost">${Helpers.formatCurrency(cost)}</span> / 
                        <span class="rp">${costRP} P&D</span>
                    </small>
                `;
                return button;
            }
            
            /** Atualiza o estado de bot√µes (ex: "Pr√≥ximo M√™s") */
            updateButtonStates(state, isEventActive) {
                this.dom.nextMonthButton.disabled = isEventActive;
                this.dom.showReportButton.disabled = isEventActive;
                
                // Desabilita todos os bot√µes de a√ß√£o/P&D se um evento estiver ativo
                this.dom.decisionsColumn.querySelectorAll('button').forEach(b => {
                    if (isEventActive) b.disabled = true;
                });
                this.dom.researchColumn.querySelectorAll('button').forEach(b => {
                    if (isEventActive) b.disabled = true;
                });
            }

            /**
             * Adiciona uma entrada ao Log de Eventos na tela
             * @param {string} message - A mensagem (pode conter HTML)
             * @param {string} type - 'good', 'bad', 'neutral', 'sabia'
             */
            addLog(message, type = 'neutral') {
                const p = document.createElement('p');
                p.innerHTML = message;
                p.className = `c-game-log__entry c-game-log__entry--${type}`;
                
                // 'prepend' coloca o item mais novo no TOPO do log.
                this.dom.gameLog.prepend(p);
            }
            
            /** Atualiza a caixa de dicas do Professor Sabi√° */
            updateSabiaTip(title, text) {
                this.dom.sabiaTipTitle.textContent = title;
                this.dom.sabiaTipText.textContent = text;
                // Anima√ß√£o sutil
                this.dom.sabiaMentorBox.style.animation = 'none';
                void this.dom.sabiaMentorBox.offsetWidth; // Truque para reiniciar a anima√ß√£o
                this.dom.sabiaMentorBox.style.animation = 'fadeIn 0.5s';
            }

            /** Mostra ou esconde um modal
             * @param {string} modalId - 'report-modal', 'event-modal', 'sabia-quiz-modal'
             * @param {boolean} show - true para mostrar, false para esconder
             */
            showModal(modalId, show = true) {
                const modal = this.dom[modalId];
                if (modal) {
                    modal.style.display = show ? 'block' : 'none';
                }
            }
            
            /** Preenche e mostra o modal de Evento
             * @param {object} event - O objeto do evento
             * @param {Function} choiceCallback - A fun√ß√£o a ser chamada quando uma escolha √© feita
             */
            showEventModal(event, choiceCallback) {
                this.dom.eventModalTitle.textContent = event.title;
                this.dom.eventModalMessage.textContent = event.message;
                this.dom.eventModalChoices.innerHTML = ''; // Limpa escolhas
                
                event.choices.forEach((choice, index) => {
                    const button = document.createElement('button');
                    button.className = 'c-btn c-btn--event c-btn--full-width';
                    button.textContent = choice.text;
                    button.onclick = () => {
                        choiceCallback(index); // Avisa ao 'Game' qual escolha foi feita
                        this.showModal('eventModal', false);
                    };
                    this.dom.eventModalChoices.appendChild(button);
                });
                
                this.showModal('eventModal', true);
            }
            
            /** Preenche e mostra o modal de Quiz do Sabi√°
             * @param {object} quiz - O objeto da pergunta
             * @param {Function} answerCallback - A fun√ß√£o a ser chamada na resposta
             */
            showSabiaQuizModal(quiz, answerCallback) {
                this.dom.sabiaQuizQuestion.textContent = quiz.question;
                this.dom.sabiaQuizChoices.innerHTML = '';
                this.dom.sabiaQuizFeedback.innerHTML = '';
                
                // Randomiza a ordem das op√ß√µes
                const options = [...quiz.options].sort(() => Math.random() - 0.5);
                
                options.forEach(optionText => {
                    const button = document.createElement('button');
                    button.className = 'c-btn c-btn--decision c-btn--full-width';
                    button.textContent = optionText;
                    button.onclick = () => {
                        const isCorrect = (optionText === quiz.answer);
                        // Mostra o feedback
                        this.dom.sabiaQuizFeedback.innerHTML = isCorrect ?
                            `<span class="u-text-success"><strong>Correto!</strong> ${quiz.explanation}</span>` :
                            `<span class="u-text-danger"><strong>Quase!</strong> A resposta correta √© <strong>${quiz.answer}</strong>. ${quiz.explanation}</span>`;
                        
                        // Desabilita bot√µes
                        this.dom.sabiaQuizChoices.querySelectorAll('button').forEach(b => b.disabled = true);
                        
                        // Envia a resposta (correta ou n√£o) para o 'Game'
                        answerCallback(isCorrect);
                    };
                    this.dom.sabiaQuizChoices.appendChild(button);
                });
                
                this.showModal('sabiaQuizModal', true);
            }

            /** Renderiza o gr√°fico de barras no modal de relat√≥rio */
            renderReportChart(history) {
                this.dom.chartContainer.innerHTML = ''; // Limpa
                
                if (history.budget.length === 0) {
                    this.dom.chartContainer.innerHTML = "<p>Nenhum dado para exibir. Avance pelo menos um m√™s.</p>";
                    return;
                }
                
                // Acha os valores m√°ximos para escalar o gr√°fico (altura 100%)
                const maxBudget = Math.max(...history.budget, 1);
                const maxWaste = Math.max(...history.waste, 50); // M√≠nimo de 50
                const maxSustain = 100;

                for (let i = 0; i < history.budget.length; i++) {
                    const monthWrapper = document.createElement('div');
                    monthWrapper.className = 'c-chart-bar-wrapper';

                    // Fun√ß√£o auxiliar para criar cada barra
                    const createBar = (className, value, maxValue, label) => {
                        const bar = document.createElement('div');
                        bar.className = `c-chart-bar c-chart-bar--${className}`;
                        // Altura em %
                        bar.style.height = `${Helpers.clamp((value / maxValue) * 100, 5, 100)}%`; 
                        bar.title = `${label}: ${value.toFixed(0)}`;
                        bar.innerHTML = `<span class="c-chart-bar__value">${value.toFixed(0)}</span>`;
                        return bar;
                    };
                    
                    // Cria as 3 barras para o m√™s
                    monthWrapper.appendChild(createBar('budget', history.budget[i], maxBudget, 'Or√ßamento'));
                    monthWrapper.appendChild(createBar('sustainability', history.sustainability[i], maxSustain, 'Sustentabilidade'));
                    monthWrapper.appendChild(createBar('waste', history.waste[i], maxWaste, 'Desperd√≠cio'));

                    // Adiciona o label do M√™s
                    const label = document.createElement('span');
                    label.className = 'c-chart-bar__label';
                    label.textContent = `M√™s ${i + 1}`;
                    monthWrapper.appendChild(label);
                    
                    this.dom.chartContainer.appendChild(monthWrapper);
                }
            }
            
            /** Renderiza a tela final */
            renderEndScreen(state, finalMessage, isWin) {
                this.renderStats(state, this.dom.finalStatsGrid);
                this.dom.finalMessage.textContent = finalMessage;
                // Remove classes antigas e adiciona a nova
                this.dom.finalMessage.className = '';
                this.dom.finalMessage.classList.add(isWin ? 'u-text-success' : 'u-text-danger');
                
                this.switchScreen('end');
                this.toggleMusic(false); // Pausa a m√∫sica
            }
        }
        
        
        /* ==========================================================================
           VIRTUAL FILE: /js/modules/ProfessorSabia.js
           DESCRI√á√ÉO: A "IA" do mentor.
                      L√™ o estado e decide qual dica ou pergunta fazer.
           ========================================================================== */
        
        // PROFESSOR SABI√Å: 
        // Ol√°! Esta √© a minha classe, meu "c√©rebro".
        // Eu sou um "m√≥dulo". O 'Game' (Controlador) me passa o 'State' (Modelo)
        // e a 'UI' (Vis√£o).
        //
        // Meu trabalho √©:
        // 1. Olhar o 'state' e ver se voc√™ precisa de ajuda (ex: 'state.budget < 500').
        // 2. Se precisar, eu chamo 'ui.updateSabiaTip(...)' para te avisar.
        // 3. De vez em quando, eu chamo 'ui.showSabiaQuizModal(...)' para
        //    fazer uma pergunta sobre o c√≥digo que voc√™ est√° vendo.
        
        class ProfessorSabia {
            constructor(ui) {
                this.ui = ui; // Recebe a UI para poder control√°-la
                this.lastQuizMonth = -1;
            }
            
            /** Loga uma mensagem no console com o estilo do Sabi√° */
            log(message, type = 'sabia') {
                const s = `<strong>Professor Sabi√°:</strong> "${message}"`;
                this.ui.addLog(s, type);
            }
            
            /** Mensagem de boas-vindas */
            greet(playerName, profileName) {
                this.log(`Ol√°, ${playerName}! Um ${profileName}, hein? Uma escolha audaciosa! Sua jornada na EcoF√°brica come√ßa agora. Estou aqui para ajudar!`);
            }
            
            /** Analisa o estado e d√° uma dica contextual */
            giveContextualTip(state) {
                let tipToShow = "As coisas parecem est√°veis. Continue com o bom planejamento!";
                let tipTitle = "Relat√≥rio do Professor Sabi√°";
                
                // Procura por uma dica de "problema" primeiro
                const problemTip = SABIA_KNOWLEDGE_BASE.gameTips.find(tip => {
                    return tip.condition(state);
                });
                
                if (problemTip) {
                    tipToShow = problemTip.tip;
                    tipTitle = "ü¶â Alerta do Professor Sabi√°!";
                } else {
                    // Se n√£o houver problema, pega uma dica gen√©rica
                    const genericTips = [
                        "N√£o se esque√ßa de investir em P&D! O conhecimento de hoje √© o lucro de amanh√£.",
                        "Manter a Moral da Equipe alta resulta em mais Pontos de P&D passivos.",
                        "Reputa√ß√£o alta pode aumentar o pre√ßo dos seus produtos. Fique de olho!",
                        "Desperd√≠cio n√£o √© s√≥ ruim para o planeta, ele gera custos diretos todo m√™s!"
                    ];
                    tipToShow = Helpers.getRandomItem(genericTips);
                    tipTitle = "ü¶â Dica do Professor Sabi√°";
                }
                
                this.ui.updateSabiaTip(tipTitle, tipToShow);
            }
            
            /** Decide se √© hora de fazer uma pergunta do quiz */
            attemptToAskQuiz(state, gameInstance) {
                // N√£o faz pergunta no primeiro m√™s ou se um evento estiver ativo
                if (state.currentMonth <= 1 || state.isEventActive) return;
                
                // S√≥ faz uma pergunta a cada 2 meses (e 30% de chance)
                if (state.currentMonth > this.lastQuizMonth + 1 && Math.random() < 0.3) {
                    this.lastQuizMonth = state.currentMonth;
                    
                    const question = Helpers.getRandomItem(SABIA_KNOWLEDGE_BASE.quizQuestions);
                    if (question) {
                        this.log("Vamos fazer uma pausa r√°pida para testar seu conhecimento de c√≥digo!");
                        
                        // Mostra o quiz e define o que fazer quando o usu√°rio responder
                        this.ui.showSabiaQuizModal(question, (isCorrect) => {
                            // O 'gameInstance' (o 'Game') √© passado para c√°
                            // para que o Sabi√° possa recompensar o jogador.
                            gameInstance.handleQuizResult(isCorrect);
                        });
                    }
                }
            }
            
            /** Loga o resultado do quiz */
            logQuizResult(isCorrect) {
                if (isCorrect) {
                    this.log("Parab√©ns, resposta correta! Voc√™ ganhou +3 Pontos de P&D como b√¥nus!", 'good');
                } else {
                    this.log("Quase! Mas n√£o se preocupe, o importante √© aprender. Continue estudando o c√≥digo!", 'bad');
                }
            }
        }


        /* ==========================================================================
           VIRTUAL FILE: /js/core/Game.js
           DESCRI√á√ÉO: O "Motor" central do Jogo (Controlador).
                      Orquestra o State, a UI e os M√≥dulos.
           ========================================================================== */
        
        // PROFESSOR SABI√Å: 
        // Esta √© a classe 'Game', o "Maestro" da orquestra.
        // √â o "Controlador" (o 'C' do MVC).
        
        // Ela n√£o sabe *como* desenhar a tela (isso √© trabalho da UI).
        // Ela n√£o sabe *como* calcular o lucro (isso √© trabalho do State).
        
        // O trabalho dela √© dizer:
        // 1. "UI, tela de in√≠cio!"
        // 2. (Usu√°rio clica) "State, inicie com o perfil 'Vision√°rio'."
        // 3. "UI, mostre a tela do jogo!"
        // 4. "Sabi√°, d√™ as boas-vindas."
        // 5. (Usu√°rio clica 'Avan√ßar M√™s') "State, calcule o pr√≥ximo m√™s."
        // 6. "State, tem algum evento?"
        // 7. "UI, renderize o novo estado."
        // 8. "UI, mostre este evento."
        // 9. "Sabi√°, d√™ uma dica sobre o novo estado."
        //
        // Ela √© a chefe que coordena tudo.
        
        class Game {
            constructor() {
                // Inicializa os componentes principais
                // (Inje√ß√£o de Depend√™ncia)
                this.state = new GameState();
                this.ui = new GameUI();
                this.sabia = new ProfessorSabia(this.ui); // O Sabi√° precisa da UI para falar
                
                this.isEventActive = false; // Controle de fluxo
            }
            
            /** Inicia o jogo, liga os listeners */
            init() {
                this.ui.bindEvents(this); // Passa 'this' (a pr√≥pria classe Game) para a UI
                this.ui.switchScreen('start');
            }
            
            /** Chamado pelo bot√£o 'Start' */
            startGame(playerName, profileId) {
                this.state.initialize(playerName, profileId);
                
                const s = this.state.get();
                const profileName = GAME_DATA.profiles[s.managerProfile].name;
                
                this.ui.switchScreen('game');
                this.ui.toggleMusic(true); // Tenta tocar a m√∫sica
                this.sabia.greet(s.playerName, profileName);
                
                // Avan√ßa para o M√™s 1
                this.advanceMonth(true);
            }
            
            /** O "Game Loop" principal */
            advanceMonth(isFirstMonth = false) {
                if (this.isEventActive) return; // N√£o avan√ßa se um evento estiver ativo
                
                // 1. Processa os c√°lculos do m√™s (lucros, custos, etc.)
                if (!isFirstMonth) {
                    const summary = this.state.processMonthlyTurn();
                    this.ui.addLog(`M√™s fechado. Receita: ${Helpers.formatCurrency(summary.income)}, Custos: ${Helpers.formatCurrency(summary.expenses)}. Lucro/Preju√≠zo: ${Helpers.formatCurrency(summary.profit)}.`, 'neutral');
                } else {
                    this.state.currentMonth = 1; // Pula para o m√™s 1
                }
                
                // 2. Verifica condi√ß√µes de Fim de Jogo
                const s = this.state.get();
                if (s.budget <= 0) {
                    this.endGame(true); // Fal√™ncia
                    return;
                }
                if (s.currentMonth > GAME_DATA.totalMonths) {
                    this.endGame(false); // Fim do tempo
                    return;
                }
                
                // 3. Verifica Eventos Aleat√≥rios
                const event = this.state.checkForRandomEvent();
                if (event) {
                    this.isEventActive = true;
                    this.ui.showEventModal(event, (choiceIndex) => {
                        this.handleEventChoice(event, choiceIndex);
                    });
                    this.ui.addLog(`EVENTO: ${event.title}`, 'bad');
                }

                // 4. Renderiza a UI com o novo estado
                this.ui.render(s, this.state.history, this.isEventActive);
                
                // 5. Professor Sabi√° d√° sua dica do m√™s
                this.sabia.giveContextualTip(s);
                
                // 6. Professor Sabi√° tenta fazer um Quiz
                if (!this.isEventActive) {
                    this.sabia.attemptToAskQuiz(s, this);
                }
            }
            
            /** Chamado pela UI quando uma A√ß√£o √© clicada */
            handleAction(actionId) {
                if (this.isEventActive) return;
                
                const action = GAME_DATA.actions[actionId];
                if (!action) return;
                
                // Aplica os efeitos no estado
                this.state.applyItemEffects(action);
                
                // Loga e atualiza a UI
                this.ui.addLog(`A√ß√£o realizada: ${action.label} (Custo: ${Helpers.formatCurrency(action.cost || 0)})`, 'good');
                this.ui.render(this.state.get(), this.state.history, this.isEventActive);
            }
            
            /** Chamado pela UI quando uma P&D √© clicada */
            handleResearch(techId) {
                if (this.isEventActive) return;

                const tech = GAME_DATA.researchTree[techId];
                if (!tech) return;
                
                // Aplica os efeitos no estado
                this.state.applyItemEffects(tech);
                
                // Loga e atualiza a UI
                this.ui.addLog(`Pesquisa conclu√≠da: ${tech.label} (Custo: ${tech.costRP} P&D)`, 'good');
                this.ui.render(this.state.get(), this.state.history, this.isEventActive);
            }
            
            /** Chamado pela UI (modal) quando uma escolha de evento √© feita */
            handleEventChoice(event, choiceIndex) {
                const choice = event.choices[choiceIndex];
                if (!choice) return;
                
                // Aplica os efeitos da escolha
                this.state.applyEventChoice(choice);
                
                // Loga o resultado
                this.ui.addLog(`Resultado do Evento: ${choice.log}`, 'neutral');
                
                // Libera o jogo
                this.isEventActive = false;
                this.ui.render(this.state.get(), this.state.history, this.isEventActive);
                
                // Tenta fazer o quiz agora que o evento acabou
                this.sabia.attemptToAskQuiz(this.state.get(), this);
            }
            
            /** Chamado pelo Sabi√° quando o quiz √© respondido */
            handleQuizResult(isCorrect) {
                if (isCorrect) {
                    // Recompensa: +3 P&D
                    this.state.currentState.researchPoints += 3;
                    this.sabia.logQuizResult(true);
                    // Atualiza a UI para mostrar os novos pontos de P&D
                    this.ui.renderStats(this.state.get(), this.ui.dom.statsGrid);
                } else {
                    this.sabia.logQuizResult(false);
                }
            }
            
            /** Chamado pela UI para mostrar o relat√≥rio */
            showReport() {
                if (this.isEventActive) return;
                this.ui.renderReportChart(this.state.history);
                this.ui.showModal('reportModal', true);
            }

            /** Encerra o jogo e mostra a tela final */
            endGame(isBankruptcy) {
                const finalMessage = this.state.getFinalMessage(isBankruptcy);
                const didWin = !isBankruptcy && this.state.checkWinCondition();
                
                this.ui.renderEndScreen(this.state.get(), finalMessage, didWin);
            }
        }


        /* ==========================================================================
           VIRTUAL FILE: /js/main.js
           DESCRI√á√ÉO: Ponto de Entrada da Aplica√ß√£o.
                      Cria a inst√¢ncia do Jogo e inicia.
           ========================================================================== */
        
        // PROFESSOR SABI√Å: 
        // E aqui... tudo come√ßa!
        // Ap√≥s o "DOMContentLoaded", n√≥s apenas criamos
        // UMA inst√¢ncia da classe 'Game' e chamamos o m√©todo '.init()'.
        // O resto da m√°gica acontece dentro das classes que escrevemos.
        //
        // Limpo, organizado e profissional.
        // Boa sorte na sua gest√£o, jovem aprendiz!
        
        const ecoGame = new Game();
        ecoGame.init();

    }); // Fim do 'DOMContentLoaded'
    </script>
</body>
</html>